"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crypto"),t=require("node-fetch"),r=require("uuid");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var i=o(e),s=n(t);function a(e,t){return i.createHmac("sha256",e).update(t).digest("hex")}exports.WebhookClient=class{constructor({api_version:e,hooks:t=[],name:r,secret:n,mode:o="sandbox"}){this.api_version=e,this.hooks=t,this.secret=n,this.mode=o,this.name=r,this.internalEvent=[]}trigger(e,t){const n=this.getWebhooks(e);return Promise.all(n.map((({url:n})=>this.post(n,{idempotency_key:r.v4(),api_version:this.api_version,type:e,data:t}))))}add(e,t){const r={url:e,events:t};this.hooks.push(r)}$onDone(e){this.internalEvent.push(e)}getWebhooks(e){return this.hooks.filter((t=>!t.events||t.events.includes(e)))}async post(e,t){const n={...t,id:r.v4(),created:Date.now()},o=JSON.stringify(null!=n?n:{}),i={method:"POST",headers:{"Content-Type":"application/json","X-Environment":this.mode,[`X${this.name?`-${this.name}`:""}-Signature`]:a(this.secret,o)},body:o},u=await s.default(e,i);return await Promise.all(this.internalEvent.map((t=>t(e,n,u)))),u}},exports.createSecret=function(e=32){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let n=0;n<e;n++)r+=t.charAt(Math.floor(Math.random()*t.length));return r},exports.verifySignature=function(e,t,r){return a(e,r)===t};
